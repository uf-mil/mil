This is a guide for operating the sub.

# Startup on the Sub

## Start a launch session

Start a launch tmux session so others know where to look for the launch output:
```shell
launch_sess
# or
tmux new -s launch
```
 _[tmux](http://www.hamvocke.com/blog/a-quick-and-easy-guide-to-tmux/) is great because it allows us to re-attach to terminal instances after losing connection with the sub._

## Perform a systems check
This allows us to test if all the thrusters are connected and working properly. By pressing * we select all the thrusters at once. By using the up and down arrow keys we can command more thrust to be generated by the thrusters. 
```shell
subthruster_spinner
```
A self checking node exists to run a system check on everything the sub needs to perform nominally. For the most reliable results, run this check whilst in the water:
```shell
rosrun subjugator_launch self_check.py
```

It will prompt you to make sure certain certain launches are running as well. In the launch tmux session, run:
```shell
roslaunch subjugator_launch sub8.launch
```
and on a terminal on a shore computer that is `rsub`ed in (has its `ROS_MASTER_URI` set to the sub) run:
```shell
roslaunch subjugator_launch shore_control.launch
```
The self check should complete, and hopefully almost everything passed!

## Start station-keeping
The next step is clearing the initial kill that is raised on launch. **NOTE: CLEARING THIS KILL WILL START SPINNING PROPS AND CAUSE THE SUB TO MOVE.** Usually it is best to check in rviz that odom looks stable before doing this and not be near any walls.
Make sure you have a kill ready in another terminal in case you need to quickly kill the sub!
```shell
# get this command ready in a terminal that is rsubed in!
araise kill

# run this command to start station-keeping
aclear kill

# if you don't have .sub_aliases sourced, replace a<raise|clear> 
# with rosrun ros_alarms <raise|clear>
```

Open a second tmux terminal or window and run:
```shell
roslaunch subjugator_launch blueview.launch
``` 
This launches our Active Sonar. This has historically had driver issues and thus is launched separately.

 Open a third tmux terminal or window and run:
```shell
roslaunch subjugator_pointcloud ogrid.launch
``` 
Launches the Occupancy Grid generated by our Active Sonar. As of posting this is still undergoing fine tuning and testing so it is currently launched separately.

Happy Subbing!

# Commanding a wrench manually

Sometimes you will want to check to make sure all the props are moving the in right direction in the pool or on land in the lab, in these cases publishing a direct wrench to be executed is desired. Do so as follows:

```shell
rostopic pub /wrench geometry_msgs/WrenchStamped (tab-tab) -r20
```

_Note: as per standard connection +x is forward, +y is left, and +z is up._

# Commanding a thruster manually

This lets you publish a list of thrusts. For just one, supply the thruster name and a force (in Newtons) that you'd like to apply.

```shell
rostopic pub /thusters/thrust /sub8_msgs/Thrust (tab-tab) -r20
```

# Commanding a wrench or thruster using rqt

Alternatively, you can use the [**rqt**](http://wiki.ros.org/rqt) `Message Publisher` to send either wrench or thruster commands using a graphical interface. Run:

```shell
rosrun rqt_publisher rqt_publisher
```

Set the topic and msg type to /wrench and geometry_msgs/WrenchStamped respectively or /thrusters/thrust and /sub8_msgs/Thrust. Press the green plus icon to add this msg. Modify the msg fields to reflect your desired command. Set the frequency to 20 Hz and check the leftmost box to start publishing.

